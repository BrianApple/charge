<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no"/>
    <style type="text/css">
        body, html, #allmap {
            width: 100%;
            height: 100%;
            overflow: hidden;
            margin: 0;
            font-family: "微软雅黑";
        }
    </style>
    <!--百度地图展现包-->
    <script type="text/javascript"
            src="http://api.map.baidu.com/api?v=2.0&ak=005a0a68e5fe76c50fbb5c1383653203"></script>

    <!--坐标转换包-->
    <script type="text/javascript" src="http://developer.baidu.com/map/jsdemo/demo/convertor.js"></script>

    <title>云能源移动平台</title>
</head>
<body>
<a href="baidumap://map/direction?origin=34.264642646862,108.95108518068&destination=40.007623,116.360582&mode=driving&src=webapp.navi.yourCompanyName.yourAppName"
   class="btn btn-primary btn-lg active" role="button">驾车导航</a>
<!--调起IOS百度地图APP-->
<div id="allmap" style="width: 600px;margin: 0 auto"></div>

</body>
</html>
<script type="text/javascript">


    //获取手机型号
    var user = navigator.userAgent;
    var isAndroid = user.indexOf('Android') > -1 || user.indexOf('Adr') > -1; //android终端
    var isiOS = !!user.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/); //ios终端
    if (isAndroid) {
        alert('您的手机型号是android');
    }
    if (isiOS) {
        alert('您的手机型号是ios');

    }




    //H5获取地理位置
    navigator.geolocation.getCurrentPosition(function (position) {
        var x = position.coords.longitude;
        var y = position.coords.latitude;



        //百度地图API
        var map = new BMap.Map("allmap", {minZoom: 10});//minZoom:10：设置最小缩放比例
        map.enableScrollWheelZoom();   //启用滚轮放大缩小，默认禁用
        map.enableContinuousZoom();    //启用地图惯性拖拽，默认禁用
        var marker = null;
        //更换标注点图标

        var myIcon = new BMap.Icon("http://api.map.baidu.com/img/markers.png", new BMap.Size(23, 25), {
            offset: new BMap.Size(10, 25), // 指定定位位置
            imageOffset: new BMap.Size(0, 0 - 10 * 25) // 设置图片偏移
        });

        setTimeout(function () {
            //坐标转换
            var gpsPoint = new BMap.Point(x, y);
            BMap.Convertor.translate(gpsPoint, 0, function (point) {
                var geoc = new BMap.Geocoder();

                geoc.getLocation(point, function (rs) {
                    alert("经度:"+point.lat+"纬度:"+point.lng);
                    var addComp = rs.addressComponents;
                    //alert(addComp.province + ", " + addComp.city + ", " + addComp.district + ", " + addComp.street + ", " + addComp.streetNumber);
                    marker = new BMap.Marker(point, {icon: myIcon});
                    //将标注点添加到地图上
                    map.addOverlay(marker);
                    //当前位置设置到中心点
                    //map.panTo(pt);
                    marker.setAnimation(BMAP_ANIMATION_BOUNCE); //跳动的动画
                    map.centerAndZoom(point, 12);

                    //创建标注点数组
                    //todo,此处将来需要获取后台数据
                    var markerArr = [
                        {point: "120.219701,30.297324", address: "杭州东站"},
                        {point: "120.176506,30.347771", address: "杭州北站"},
                        {point: "120.189603,30.249221", address: "杭州站"}
                    ];

                    var p = new Array();
                    var marker1 = {};

                    //遍历标注点数组中的信息
                    for (var i = 0; i < markerArr.length; i++) {
                        var lon = markerArr[i].point.split(",")[0];
                        var lat = markerArr[i].point.split(",")[1];
                        var address = markerArr[i].address;
                        console.log(address);

                        p[i] = new BMap.Point(lon, lat);
                        marker1 = new BMap.Marker(p[i]);
                        //将标注点添加到地图上
                        map.addOverlay(marker1);
                        //动态降落marker
                        marker1.setAnimation(BMAP_ANIMATION_DROP);
                        getAddressInfo(lon, lat, address);

                    }

                    //获取地理位置执行导航
                    function getAddressInfo(lon, lat, address) {
                        marker1.addEventListener('click', function () {

                            //执行导航
                            window.location.href = 'http://api.map.baidu.com/direction?origin=latlng:' +
                                    point.lat + ',' +
                                    point.lng +
                                    '|name:当前位置&destination=' +
                                    address +
                                    '&mode=driving&region=' +
                                    addComp.city +
                                    '&output=html&src=yourCompanyName|yourAppName';
                        });
                    }
                });
            });

        }, 1000);
    });


</script>
